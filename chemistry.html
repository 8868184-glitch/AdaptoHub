<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Level Chemistry Pathway | AdaptoHub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script defer src="app.js"></script>`n    <script defer src="time-tracker.js"></script>`n    <script defer src="proficiency-tracker.js"></script>
    <script defer src="dark-mode.js"></script>
    <script defer src="celebrations.js"></script>
    <script defer src="avatar-system.js"></script>
    <script defer src="quiz-animations.js"></script>
    <script defer src="smooth-animations.js"></script>
    <script defer src="loading-tips.js"></script>
    <script defer src="loading-tips-integration.js"></script>
    <script defer src="feature-integration.js"></script>
    <script defer src="achievements.js"></script>
    <script defer src="gamification.js"></script>
    <script defer src="gamification-quiz-integration.js"></script>
    <script defer src="background-customizer.js"></script>
    <script>
        function updateClock(){const now=new Date();const options={weekday:'short',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'};const clockEl=document.getElementById('realTimeClock');if(clockEl)clockEl.textContent=now.toLocaleString('en-US',options);}window.addEventListener('load',()=>{updateClock();setInterval(updateClock,1000);const darkModeToggle=document.getElementById('darkModeToggle');const isDark=localStorage.getItem('darkMode')==='true';if(isDark){document.documentElement.setAttribute('data-theme','dark');darkModeToggle.textContent='☀️';}darkModeToggle.addEventListener('click',()=>{const currentTheme=document.documentElement.getAttribute('data-theme');if(currentTheme==='dark'){document.documentElement.setAttribute('data-theme','light');localStorage.setItem('darkMode','false');darkModeToggle.textContent='🌙';}else{document.documentElement.setAttribute('data-theme','dark');localStorage.setItem('darkMode','true');darkModeToggle.textContent='☀️';}});});
    </script>
    <style>
        body {
            margin: 0;
            background: #f4f7fb;
            font-family: 'Bai Jamjuree', sans-serif;
            color: #0f1724;
        }
        .chemistry-shell {
            max-width: 1200px;
            margin: 100px auto 60px;
            padding: 0 24px;
        }
        .hero-card {
            background: linear-gradient(135deg, #6a1b9a 0%, #8e24aa 60%, #ab47bc 100%);
            color: #ffffff;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 20px 40px rgba(106, 27, 154, 0.25);
            position: relative;
            overflow: hidden;
        }
        .hero-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.14), transparent 35%),
                        radial-gradient(circle at 80% 10%, rgba(255,255,255,0.16), transparent 28%),
                        radial-gradient(circle at 60% 70%, rgba(255,255,255,0.12), transparent 32%);
            pointer-events: none;
        }
        .hero-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            align-items: center;
        }
        .hero-title { margin: 0 0 10px 0; font-size: 2rem; letter-spacing: -0.02em; }
        .hero-subtitle { margin: 0; font-size: 1.05rem; color: #f3e5f5; }
        .tag-row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
        .pill { padding: 8px 12px; border-radius: 999px; background: rgba(255,255,255,0.16); color: #f3e5f5; font-weight: 600; font-size: 0.9rem; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; }
        .summary-card { background: rgba(255,255,255,0.12); border-radius: 12px; padding: 14px; border: 1px solid rgba(255,255,255,0.18); box-shadow: inset 0 1px 0 rgba(255,255,255,0.25); }
        .summary-card span { display: block; color: #f3e5f5; font-size: 0.85rem; }
        .summary-card strong { font-size: 1.3rem; color: #ffffff; }
        .progress-wrap { margin-top: 16px; }
        .progress-label { display: flex; justify-content: space-between; font-size: 0.9rem; color: #f3e5f5; margin-bottom: 6px; }
        .progress-bar { width: 100%; height: 10px; background: rgba(255,255,255,0.18); border-radius: 6px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #80e27e 0%, #4caf50 100%); width: 0%; transition: width 0.25s ease; }
        .unit-grid { display: grid; grid-template-columns: 1fr; gap: 18px; margin-top: 28px; }
        .unit-card { background: #ffffff; border-radius: 14px; padding: 22px; box-shadow: 0 12px 30px rgba(0,0,0,0.05); border: 1px solid #e7edf3; position: relative; overflow: hidden; }
        .unit-header { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: space-between; }
        .unit-label { display: inline-flex; align-items: center; gap: 8px; background: #f3e5f5; color: #6a1b9a; padding: 8px 12px; border-radius: 10px; font-weight: 700; }
        .unit-status { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 10px; font-weight: 700; font-size: 0.9rem; }
        .status-done { background: #e7f6ec; color: #1b5e20; }
        .status-pending { background: #fff4e5; color: #a15c04; }
        .status-locked { background: #ffe4e6; color: #b42318; }
        .unit-title { margin: 6px 0 10px; font-size: 1.35rem; letter-spacing: -0.01em; color: #0f1724; }
        .unit-desc { margin: 0 0 12px; color: #4b5563; line-height: 1.55; }
        .lesson-points { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 8px; margin: 12px 0 6px; }
        .lesson-point { padding: 10px 12px; background: #f4f7fb; border-radius: 10px; border: 1px solid #e7edf3; font-size: 0.95rem; color: #111827; }
        .formula-badges { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0 14px; }
        .formula-badge { background: #6a1b9a; color: #f3e5f5; padding: 8px 12px; border-radius: 10px; font-weight: 700; font-size: 0.9rem; }
        .quiz-block { margin-top: 12px; padding: 14px; background: #f8fafc; border: 1px dashed #cbd5e1; border-radius: 12px; }
        .quiz-title { margin: 0 0 8px; font-size: 1rem; color: #0f1724; }
        .quiz-option { display: flex; gap: 10px; align-items: flex-start; padding: 9px 10px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 10px; margin-bottom: 8px; cursor: pointer; transition: border 0.2s ease, transform 0.2s ease; }
        .quiz-option:hover { border-color: #6a1b9a; transform: translateY(-1px); }
        .quiz-option input { margin-top: 3px; }
        .quiz-actions { display: flex; gap: 10px; align-items: center; margin-top: 10px; flex-wrap: wrap; }
        .primary-btn { background: #6a1b9a; color: #ffffff; border: none; padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: background 0.2s ease, transform 0.2s ease; }
        .primary-btn:hover { background: #7b1fa2; transform: translateY(-1px); }
        .primary-btn:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; }
            .secondary-btn { background: #f0f0f0; color: #6a1b9a; border: 1px solid #d0d0d0; padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: background 0.2s ease, transform 0.2s ease; }
            .secondary-btn:hover { background: #e0e0e0; transform: translateY(-1px); }
            .danger-btn { background: #b42318; color: #ffffff; border: none; padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: background 0.2s ease, transform 0.2s ease; }
            .danger-btn:hover { background: #922118; transform: translateY(-1px); }
            .reset-section { margin-top: 28px; text-align: center; padding: 20px; background: #fff5f5; border-radius: 14px; border: 1px solid #ffe4e6; }
            .reset-section p { margin: 0 0 12px; color: #4b5563; }
        .ghost-link { display: inline-flex; align-items: center; gap: 8px; color: #6a1b9a; font-weight: 700; text-decoration: none; padding: 8px 12px; border: 1px solid #e1bee7; border-radius: 10px; background: #fce4ec; }
        .quiz-result { font-weight: 700; font-size: 0.95rem; }
        .result-pass { color: #1b5e20; }
        .result-fail { color: #b42318; }
        .locked-note { color: #b42318; font-weight: 700; margin: 6px 0 0; }
        .top-nav { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .top-nav a { text-decoration: none; }
        @media (max-width: 900px) { .hero-grid { grid-template-columns: 1fr; } }
        @media (max-width: 600px) { .unit-card { padding: 18px; } .hero-title { font-size: 1.6rem; } }

        /* Dark Mode Styles */
        [data-theme="dark"] body { background: #1a1d23; color: #e6ebf1; }
        [data-theme="dark"] .shell { background: transparent; }
        [data-theme="dark"] .unit-card { background: #242830; border-color: #3a4150; box-shadow: 0 12px 30px rgba(0,0,0,0.4); }
        [data-theme="dark"] .unit-title { color: #e6ebf1; }
        [data-theme="dark"] .unit-desc { color: #b8c5d6; }
        [data-theme="dark"] .lesson-point { background: #2d333e; border-color: #3a4150; color: #e6ebf1; }
        [data-theme="dark"] .quiz-block { background: #2d333e; border-color: #3a4150; }
        [data-theme="dark"] .quiz-title { color: #e6ebf1; }
        [data-theme="dark"] .quiz-option { background: #1a1d23; border-color: #3a4150; }
        [data-theme="dark"] .quiz-option:hover { border-color: #10b981; }
        [data-theme="dark"] .secondary-btn { background: #2d333e; color: #6ee7b7; border-color: #3a4150; }
        [data-theme="dark"] .secondary-btn:hover { background: #3a4150; }
        [data-theme="dark"] .reset-section { background: rgba(180, 35, 24, 0.1); border-color: rgba(180, 35, 24, 0.3); }
        [data-theme="dark"] .reset-section p { color: #b8c5d6; }
        [data-theme="dark"] .ghost-link { background: rgba(16, 185, 129, 0.1); border-color: #047857; color: #6ee7b7; }
    </style>
</head>
<body>
    <header class="top-banner">
        <div class="logo">
            <img height="45" src="assets/AdaptoHub.png" alt="AdaptoHub Logo" />
            <a class="site-title" href="index.html">AdaptoHub</a>
        </div>        <div class="header-controls">
            <div id="realTimeClock" style="font-weight: 500; color: #fff; margin-right: 15px; font-size: 0.9rem;"></div>
            <button id="darkModeToggle" style="background: none; border: none; cursor: pointer; font-size: 1.3rem; margin-right: 15px; padding: 5px;" title="Toggle dark mode">🌙</button>
        </div>        <div class="account-display" id="accountDisplayBtn" style="cursor: pointer; position: relative;">
            <span class="account-name" id="accountName">ชญฏ ชลประเสริฐสุข</span>
            <div class="account-avatar" id="accountAvatar"></div>
            
            <div id="accountDetailsDropdown" class="account-details-dropdown" style="display: none;">
              <div style="padding: 16px; border-bottom: 1px solid #e4e7eb; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; color: #1f2933; font-size: 1rem;">Account Information</h3>
                <button onclick="document.getElementById('accountDetailsDropdown').style.display = 'none'; return false;" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #636d79; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;" onmouseover="this.style.color='#1f2933'" onmouseout="this.style.color='#636d79'">✕</button>
              </div>
              <div style="padding: 16px;">
                <div style="margin-bottom: 16px;">
                  <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Full Name</div>
                  <div id="detailsDropdownName" style="color: #1f2933; font-weight: 500; font-size: 0.95rem;">ชญฏ ชลประเสริฐสุข</div>
                </div>
                <div style="margin-bottom: 16px;">
                  <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Email Address</div>
                  <div class="user-email" id="dropdownUserEmail">8868184@student.triamudom.ac.th</div>
                </div>
                <div style="margin-bottom: 16px;">
                  <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Student ID</div>
                  <div id="detailsDropdownStudentId" style="color: #1f2933; font-weight: 500; font-size: 0.95rem;">รหัสนักเรียน: 68184 | ห้อง: 665 | เลขที่: 23 | ระดับชั้น: ม.4 | โรงเรียนเตรียมอุดมศึกษา</div>
                </div>
                <div style="margin-bottom: 16px;">
                  <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Authentication Provider</div>
                  <div id="detailsDropdownProvider" style="color: #1f2933; font-weight: 500; font-size: 0.95rem;">magic-link</div>
                </div>
                <div style="margin-bottom: 0;">
                  <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Login Date & Time</div>
                  $17/2/2569 17:27:10</div>
                </div>
              </div>
            </div>
            
            <div id="profileSettingsDropdown" class="account-details-dropdown" style="display: none;">
              <div style="padding: 16px; border-bottom: 1px solid #e4e7eb; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; color: #1f2933; font-size: 1rem;">Profile Settings</h3>
                <button onclick="document.getElementById('profileSettingsDropdown').style.display = 'none'; return false;" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #636d79; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;" onmouseover="this.style.color='#1f2933'" onmouseout="this.style.color='#636d79'">✕</button>
              </div>
              <div style="padding: 16px;">
                <div style="margin-bottom: 20px;">
                  <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Display Name</label>
                  <input type="text" id="settingsDisplayName" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95rem; color: #1f2933;" placeholder="Your display name">
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Email Notifications</label>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="settingsEmailNotif" style="margin-right: 8px; cursor: pointer;">
                    <span style="font-size: 0.9rem; color: #1f2933;">Receive email notifications</span>
                  </label>
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Theme Preference</label>
                  <select id="settingsTheme" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95rem; color: #1f2933; cursor: pointer;">
                    <option value="light">Light Mode</option>
                    <option value="dark">Dark Mode</option>
                    <option value="auto">Auto (System)</option>
                  </select>
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Language</label>
                  <select id="settingsLanguage" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95rem; color: #1f2933; cursor: pointer;">
                    <option value="en">English</option>
                    <option value="es">Español</option>
                    <option value="fr">Français</option>
                    <option value="de">Deutsch</option>
                  </select>
                </div>
                <div style="margin-bottom: 0;">
                  <button onclick="saveProfileSettings()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #0097b2 0%, #00b8d4 100%); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.95rem; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">Save Settings</button>
                </div>
              </div>
            </div>
            
            <div id="learningHistoryDropdown" class="account-details-dropdown" style="display: none;">
              <div style="padding: 16px; border-bottom: 1px solid #e4e7eb; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; color: #1f2933; font-size: 1rem;">Learning History</h3>
                <button onclick="document.getElementById('learningHistoryDropdown').style.display = 'none'; return false;" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #636d79; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;" onmouseover="this.style.color='#1f2933'" onmouseout="this.style.color='#636d79'">✕</button>
              </div>
              <div style="padding: 16px; max-height: 400px; overflow-y: auto;">
                <div style="margin-bottom: 12px; padding: 12px; background: #f5f6f8; border-radius: 8px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="font-weight: 600; color: #1f2933; font-size: 0.9rem;" id="learningHistoryStats">No activity recorded</div>
                  </div>
                  <div id="learningHistoryList" style="font-size: 0.85rem; color: #636d79;">
                    <p style="margin: 0; text-align: center; padding: 20px 0; color: #8b92a9;">Start taking quizzes and challenges to build your learning history</p>
                  </div>
                </div>
              </div>
            </div>
        </div>
        
        <div id="accountDropdownMenu" class="account-dropdown-menu" style="display: none;">
          <div class="account-dropdown-header">
            <div class="user-avatar-large" id="dropdownUserAvatar"></div>
            <div class="user-info">
              <div class="user-name" id="dropdownUserName">ชญฏ ชลประเสริฐสุข</div>
              <div class="user-email" id="dropdownUserEmail">8868184@student.triamudom.ac.th</div>
              <div class="user-id" id="dropdownStudentId">รหัสนักเรียน: 68184</div>
            </div>
          </div>
          <div class="account-dropdown-divider"></div>
          <div class="account-dropdown-body">
            <a href="javascript:void(0);" class="dropdown-item" onclick="event.preventDefault(); event.stopPropagation(); setTimeout(() => showProfileSettings(), 0); return false;">⚙️ จัดการโปรไฟล์</a>
            <a href="javascript:void(0);" class="dropdown-item" onclick="event.preventDefault(); event.stopPropagation(); setTimeout(() => showAccountDetailsPanel(), 0); return false;">📋 ข้อมูลบัญชี</a>
            <a href="javascript:void(0);" class="dropdown-item" onclick="event.preventDefault(); event.stopPropagation(); setTimeout(() => showLearningHistory(), 0); return false;">📚 ประวัติการเรียน</a>
          </div>
          <div class="account-dropdown-divider"></div>
          <div class="account-dropdown-footer">
            <button class="logout-btn" onclick="logout()">🚪 ออกจากระบบทั้งหมด</button>
          </div>
        </div>
        </header>

    <main class="chemistry-shell">
        <div class="top-nav">
            <a class="ghost-link" href="science.html">← Back to Science dashboard</a>
            <span style="color:#4b5563; font-weight:600;">A-Level Chemistry • Lessons + Quizzes after every unit</span>
        </div>

        <section class="hero-card">
            <div class="hero-grid">
                <div>
                    <h1 class="hero-title">A-Level Chemistry Learning Path</h1>
                    <p class="hero-subtitle">Sequential units with immediate mastery checks. Build lab safety foundations, then advance through atomic structure, moles, periodic trends, bonding, and gas laws.</p>
                    <div class="tag-row">
                        <span class="pill">Safety protocols</span>
                        <span class="pill">Atoms → Moles → Periodic Table</span>
                        <span class="pill">Bonds: Covalent • Ionic • Metallic</span>
                        <span class="pill">Gas laws & properties</span>
                    </div>
                </div>
                <div class="summary-cards">
                    <div class="summary-card">
                        <span>Units Completed</span>
                        <strong id="unitsCompleted">0 / 6</strong>
                    </div>
                    <div class="summary-card">
                        <span>Current Mastery</span>
                        <strong id="averageScore">0%</strong>
                    </div>
                    <div class="summary-card">
                        <span>Streak-Friendly</span>
                        <strong>Quiz every unit</strong>
                    </div>
                </div>
            </div>
            <div class="progress-wrap">
                <div class="progress-label">
                    <span>Path Completion</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="chemistryProgressFill"></div>
                </div>
            </div>
        </section>

        <section class="unit-grid" id="unitGrid"></section>

            <section class="reset-section">
                <p style="font-weight: 700; color: #0f1724;">Start Over?</p>
                <p>Reset your progress on all three science subjects (Physics, Chemistry, Biology).</p>
                <button class="danger-btn" onclick="resetAllProgress()">Reset All Science Progress</button>
            </section>
    </main>

    <script>
        const chemistryUnits = [
            {
                id: 'safety',
                title: 'Safety and Skills in Chemical Operations',
                description: 'Master laboratory safety protocols, proper equipment handling, and essential techniques for safe chemical operations.',
                points: [
                    'Always wear safety goggles, lab coat, and gloves when handling chemicals.',
                    'Know the location of safety equipment: eyewash, shower, fire extinguisher, spill kits.',
                    'Read MSDS (Material Safety Data Sheets) before using any chemical.',
                    'Never pipette by mouth; use pipette bulbs or automated pipettes.',
                    'Dispose of chemical waste in designated containers, never down the sink.'
                ],
                formulas: [
                    'Dilution: C₁V₁ = C₂V₂',
                    'Always add acid to water, never water to acid'
                ],
                quiz: [
                    {
                        id: 'q1',
                        prompt: 'What is the first step before using any chemical in the lab?',
                        options: [
                            { text: 'Read the Material Safety Data Sheet (MSDS)', correct: true },
                            { text: 'Smell the chemical to identify it', correct: false },
                            { text: 'Mix it with water', correct: false }
                        ]
                    },
                    {
                        id: 'q2',
                        prompt: 'When diluting concentrated acid, which procedure is correct?',
                        options: [
                            { text: 'Add acid slowly to water while stirring', correct: true },
                            { text: 'Add water to acid', correct: false },
                            { text: 'Mix them quickly in equal volumes', correct: false }
                        ]
                    },
                    {
                        id: 'q3',
                        prompt: 'If you need to dilute 10 mL of 6 M HCl to 2 M, what final volume do you need?',
                        options: [
                            { text: '30 mL', correct: true },
                            { text: '20 mL', correct: false },
                            { text: '12 mL', correct: false }
                        ]
                    }
                ]
            },
            {
                id: 'atom',
                title: 'Atom Structure',
                description: 'Explore atomic structure, subatomic particles, isotopes, and electron configuration at A-level depth.',
                points: [
                    'Atoms consist of protons (+), neutrons (0), and electrons (−) with distinct masses.',
                    'Atomic number (Z) = protons; mass number (A) = protons + neutrons.',
                    'Isotopes have the same Z but different A due to varying neutron counts.',
                    'Electron shells fill according to 2n² (n = shell number); use subshell notation (s, p, d, f).',
                    'Ionization energy is the energy required to remove an electron from a gaseous atom.'
                ],
                formulas: [
                    'Mass number A = Z + N',
                    'Electron capacity: 2n²',
                    'Electronic config: 1s² 2s² 2p⁶ ...'
                ],
                quiz: [
                    {
                        id: 'q1',
                        prompt: 'An element has 17 protons and 18 neutrons. What is its mass number?',
                        options: [
                            { text: '35', correct: true },
                            { text: '17', correct: false },
                            { text: '18', correct: false }
                        ]
                    },
                    {
                        id: 'q2',
                        prompt: 'Which particle determines the identity of an element?',
                        options: [
                            { text: 'Proton', correct: true },
                            { text: 'Neutron', correct: false },
                            { text: 'Electron', correct: false }
                        ]
                    },
                    {
                        id: 'q3',
                        prompt: 'What is the electron configuration of oxygen (Z = 8)?',
                        options: [
                            { text: '1s² 2s² 2p⁴', correct: true },
                            { text: '1s² 2s² 2p⁶', correct: false },
                            { text: '1s² 2p⁶', correct: false }
                        ]
                    }
                ]
            },
            {
                id: 'moles',
                title: 'Moles and Mole Relationships and Calculations',
                description: "Quantify substances using the mole concept, Avogadro's number, and stoichiometric calculations.",
                points: [
                    "One mole contains Avogadro's number (6.02 × 10²³) of particles.",
                    'Molar mass (g/mol) is the mass of one mole of a substance.',
                    'n = m/M (moles = mass / molar mass).',
                    'Use mole ratios from balanced equations for stoichiometric calculations.',
                    'Limiting reagent determines the maximum amount of product formed.'
                ],
                formulas: [
                    'n = m / M',
                    'N = n × Nₐ (Nₐ = 6.02×10²³)',
                    'Molarity M = n / V (L)'
                ],
                quiz: [
                    {
                        id: 'q1',
                        prompt: 'How many moles are in 18 g of water (H₂O, M = 18 g/mol)?',
                        options: [
                            { text: '1 mol', correct: true },
                            { text: '18 mol', correct: false },
                            { text: '0.5 mol', correct: false }
                        ]
                    },
                    {
                        id: 'q2',
                        prompt: "What is Avogadro's number?",
                        options: [
                            { text: '6.02 × 10²³', correct: true },
                            { text: '6.02 × 10²⁴', correct: false },
                            { text: '1.60 × 10⁻¹⁹', correct: false }
                        ]
                    },
                    {
                        id: 'q3',
                        prompt: 'In the reaction 2H₂ + O₂ → 2H₂O, if you have 4 mol H₂ and 1 mol O₂, which is the limiting reagent?',
                        options: [
                            { text: 'O₂', correct: true },
                            { text: 'H₂', correct: false },
                            { text: 'H₂O', correct: false }
                        ]
                    }
                ]
            },
            {
                id: 'periodic',
                title: 'The Periodic Table and Properties of Elements',
                description: 'Understand periodic trends, group characteristics, and element properties across the periodic table.',
                points: [
                    'Periods are horizontal rows; groups (families) are vertical columns.',
                    'Atomic radius decreases across a period and increases down a group.',
                    'Ionization energy increases across a period and decreases down a group.',
                    'Electronegativity increases across a period and decreases down a group.',
                    'Metals (left), metalloids (staircase), nonmetals (right); noble gases are inert.'
                ],
                formulas: [
                    'Trend: Atomic radius ↓ across, ↑ down',
                    'Trend: Ionization energy ↑ across, ↓ down',
                    'Electronegativity: F > O > N > Cl'
                ],
                quiz: [
                    {
                        id: 'q1',
                        prompt: 'Which element has the highest electronegativity?',
                        options: [
                            { text: 'Fluorine (F)', correct: true },
                            { text: 'Oxygen (O)', correct: false },
                            { text: 'Chlorine (Cl)', correct: false }
                        ]
                    },
                    {
                        id: 'q2',
                        prompt: 'What trend occurs for atomic radius moving down a group?',
                        options: [
                            { text: 'Increases', correct: true },
                            { text: 'Decreases', correct: false },
                            { text: 'Stays the same', correct: false }
                        ]
                    },
                    {
                        id: 'q3',
                        prompt: 'Which group contains the alkali metals?',
                        options: [
                            { text: 'Group 1', correct: true },
                            { text: 'Group 17', correct: false },
                            { text: 'Group 18', correct: false }
                        ]
                    }
                ]
            },
            {
                id: 'bonds',
                title: 'Chemical Bonds (Covalent, Ionic, and Metallic)',
                description: 'Distinguish bond types, predict bonding based on electronegativity, and understand bond properties.',
                points: [
                    'Ionic bonds: transfer of electrons between metal and nonmetal (ΔEN > 1.7).',
                    'Covalent bonds: sharing of electrons between nonmetals (ΔEN < 1.7).',
                    'Metallic bonds: delocalized electrons in a "sea" around metal cations.',
                    'Polar covalent bonds occur when ΔEN is between 0.4 and 1.7.',
                    'Bond strength: ionic > covalent > metallic (generalization varies by compound).'
                ],
                formulas: [
                    'ΔEN = |ENₐ − ENբ|',
                    'Ionic: ΔEN > 1.7; Covalent: ΔEN < 1.7',
                    'Lewis structure: show valence electrons'
                ],
                quiz: [
                    {
                        id: 'q1',
                        prompt: 'Which type of bond forms between Na and Cl in NaCl?',
                        options: [
                            { text: 'Ionic', correct: true },
                            { text: 'Covalent', correct: false },
                            { text: 'Metallic', correct: false }
                        ]
                    },
                    {
                        id: 'q2',
                        prompt: 'What characterizes a metallic bond?',
                        options: [
                            { text: 'Delocalized electrons in a "sea" around cations', correct: true },
                            { text: 'Sharing electrons between two atoms', correct: false },
                            { text: 'Transfer of electrons from metal to nonmetal', correct: false }
                        ]
                    },
                    {
                        id: 'q3',
                        prompt: 'If the electronegativity difference is 0.5, the bond is likely:',
                        options: [
                            { text: 'Polar covalent', correct: true },
                            { text: 'Ionic', correct: false },
                            { text: 'Nonpolar covalent', correct: false }
                        ]
                    }
                ]
            },
            {
                id: 'gases',
                title: 'Gases and Properties of Gases',
                description: 'Apply gas laws (Boyle, Charles, ideal gas) and understand kinetic molecular theory at A-level.',
                points: [
                    "Ideal gas law: PV = nRT (P in atm, V in L, T in K, R = 0.0821 L·atm/mol·K).",
                    "Boyle's Law: P₁V₁ = P₂V₂ (constant T and n).",
                    "Charles's Law: V₁/T₁ = V₂/T₂ (constant P and n).",
                    'Kinetic molecular theory: gas particles in constant random motion; collisions are elastic.',
                    'Real gases deviate from ideal behavior at high P and low T.'
                ],
                formulas: [
                    'PV = nRT',
                    'P₁V₁ = P₂V₂ (Boyle)',
                    'V₁/T₁ = V₂/T₂ (Charles)'
                ],
                quiz: [
                    {
                        id: 'q1',
                        prompt: 'A gas occupies 2.0 L at 1.0 atm. If pressure increases to 2.0 atm at constant T, what is the new volume?',
                        options: [
                            { text: '1.0 L', correct: true },
                            { text: '2.0 L', correct: false },
                            { text: '4.0 L', correct: false }
                        ]
                    },
                    {
                        id: 'q2',
                        prompt: 'In the ideal gas law PV = nRT, what does R represent?',
                        options: [
                            { text: 'Universal gas constant', correct: true },
                            { text: 'Reaction rate', correct: false },
                            { text: 'Radius of gas particles', correct: false }
                        ]
                    },
                    {
                        id: 'q3',
                        prompt: 'According to kinetic molecular theory, collisions between gas particles are:',
                        options: [
                            { text: 'Elastic', correct: true },
                            { text: 'Inelastic', correct: false },
                            { text: 'Non-existent', correct: false }
                        ]
                    }
                ]
            }
        ];

        const storageKey = 'adaptohub_chemistry_units';
        let unitProgress = JSON.parse(localStorage.getItem(storageKey) || '{}');

        function saveProgress() {
            localStorage.setItem(storageKey, JSON.stringify(unitProgress));
        }

        function renderSummary() {
            const completed = chemistryUnits.filter(u => unitProgress[u.id]?.completed).length;
            const scores = chemistryUnits.map(u => unitProgress[u.id]?.score).filter(s => typeof s === 'number');
            const avg = scores.length ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length) : 0;
            const percent = Math.round((completed / chemistryUnits.length) * 100);

            const unitsCompletedEl = document.getElementById('unitsCompleted');
            const averageScoreEl = document.getElementById('averageScore');
            const progressPercentEl = document.getElementById('progressPercent');
            const progressFillEl = document.getElementById('chemistryProgressFill');

            if (unitsCompletedEl) unitsCompletedEl.textContent = `${completed} / ${chemistryUnits.length}`;
            if (averageScoreEl) averageScoreEl.textContent = `${avg}%`;
            if (progressPercentEl) progressPercentEl.textContent = `${percent}%`;
            if (progressFillEl) progressFillEl.style.width = `${percent}%`;

                function retakeUnit(unitId) {
                    if (confirm('Retake this unit? Your previous score will be cleared.')) {
                        delete unitProgress[unitId];
                        saveProgress();
                        renderSummary();
                        renderUnits();
                    }
                }

                function resetAllProgress() {
                    if (confirm('Reset progress on ALL three science subjects (Physics, Chemistry, Biology)? This cannot be undone.')) {
                        localStorage.removeItem('adaptohub_physics_units');
                        localStorage.removeItem('adaptohub_chemistry_units');
                        localStorage.removeItem('adaptohub_biology_units');
                        unitProgress = {};
                        renderSummary();
                        renderUnits();
                        alert('All science progress has been reset.');
                    }
                }
        }

        function formatFormula(formula) {
            return formula
                .replace(/(\w)_([A-Za-z0-9]+)/g, '$1<sub>$2</sub>')
                .replace(/\^(\d+)/g, '<sup>$1</sup>')
                .replace(/([A-Za-z])([0-9]+)/g, '$1<sub>$2</sub>');
        }

        function retakeUnit(unitId) {
            if (confirm('Retake this unit? Your previous score will be cleared.')) {
                delete unitProgress[unitId];
                saveProgress();
                renderSummary();
                renderUnits();
            }
        }

        function resetAllProgress() {
            if (confirm('Reset progress on ALL three science subjects (Physics, Chemistry, Biology)? This cannot be undone.')) {
                localStorage.removeItem('adaptohub_physics_units');
                localStorage.removeItem('adaptohub_chemistry_units');
                localStorage.removeItem('adaptohub_biology_units');
                unitProgress = {};
                renderSummary();
                renderUnits();
                alert('All science progress has been reset.');
            }
        }

        function renderUnits() {
            const grid = document.getElementById('unitGrid');
            if (!grid) return;

            grid.innerHTML = '';

            chemistryUnits.forEach((unit, index) => {
                const prevUnit = chemistryUnits[index - 1];
                const locked = index > 0 && !(unitProgress[prevUnit.id]?.completed);
                const progress = unitProgress[unit.id] || {};

                const card = document.createElement('article');
                card.className = `unit-card ${locked ? 'locked' : ''}`;

                const statusClass = locked ? 'status-locked' : progress.completed ? 'status-done' : 'status-pending';
                const statusText = locked ? 'Complete the previous unit first' : progress.completed ? `Completed • ${progress.score || 0}%` : 'Quiz ready';

                const lessonList = unit.points.map(point => `<div class="lesson-point">${point}</div>`).join('');
                const formulaList = unit.formulas.map(f => `<span class="formula-badge">${formatFormula(f)}</span>`).join('');

                const questionsHtml = unit.quiz.map(q => `
                    <div class="quiz-question" style="margin-bottom:10px;">
                        <p class="quiz-title">${q.prompt}</p>
                        ${q.options.map((opt, idx) => `
                            <label class="quiz-option">
                                <input type="radio" name="${unit.id}-${q.id}" value="${opt.correct ? 'correct' : 'wrong'}" ${locked || progress.completed ? 'disabled' : ''}>
                                <span>${opt.text}</span>
                            </label>
                        `).join('')}
                    </div>
                `).join('');
                const actionButtons = progress.completed
                    ? `<button class="secondary-btn" onclick="retakeUnit('${unit.id}')">Retake Unit</button><span class="quiz-result" id="result-${unit.id}" style="margin-left: 10px;"></span>`
                    : `<button class="primary-btn" onclick="submitQuiz('${unit.id}')" ${locked ? 'disabled' : ''}>Submit quiz</button><span class="quiz-result" id="result-${unit.id}"></span>`;

                card.innerHTML = `
                    <div class="unit-header">
                        <div class="unit-label">Unit ${index + 1}</div>
                        <div class="unit-status ${statusClass}">${statusText}</div>
                    </div>
                    <h3 class="unit-title">${unit.title}</h3>
                    <p class="unit-desc">${unit.description}</p>
                    <div class="lesson-points">${lessonList}</div>
                    <div class="formula-badges">${formulaList}</div>
                    <div class="quiz-block" data-quiz="${unit.id}">
                        <p style="margin:0 0 6px; font-weight:700; color:#0f1724;">Quick mastery quiz (3 questions)</p>
                        ${locked ? `<p class="locked-note">Unlock by completing Unit ${index}</p>` : ''}
                        ${questionsHtml}
                        <div class="quiz-actions">${actionButtons}</div>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function submitQuiz(unitId) {
            const unit = chemistryUnits.find(u => u.id === unitId);
            if (!unit) return;
            if (unitProgress[unitId]?.completed) {
                alert('This unit has already been submitted. Use Retake Unit to try again.');
                return;
            }

            const quizBlock = document.querySelector(`[data-quiz="${unitId}"]`);
            if (!quizBlock) return;

            let answered = 0;
            let correct = 0;

            unit.quiz.forEach(q => {
                const selected = quizBlock.querySelector(`input[name="${unit.id}-${q.id}"]:checked`);
                if (selected) {
                    answered++;
                    if (selected.value === 'correct') correct++;
                }
            });

            if (answered !== unit.quiz.length) {
                alert('Please answer every question before submitting.');
                return;
            }

            const score = Math.round((correct / unit.quiz.length) * 100);
            unitProgress[unitId] = { completed: true, score, timestamp: Date.now(), completedDate: new Date().toISOString() };
            saveProgress();
            renderSummary();
            renderUnits();

            const resultEl = document.getElementById(`result-${unitId}`);
            if (resultEl) {
                resultEl.textContent = score >= 70 ? `Great work: ${score}%` : `Keep reviewing: ${score}%`;
                resultEl.className = `quiz-result ${score >= 70 ? 'result-pass' : 'result-fail'}`;
            }

            if (window.FeatureIntegration && window.FeatureIntegration.onQuizComplete) {
                window.FeatureIntegration.onQuizComplete(unitId, score, 'chemistry');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('Chemistry page loaded! chemistryUnits:', chemistryUnits.length);
            initializeUser();
            renderSummary();
            renderUnits();
            console.log('Chemistry render complete');
        });
    </script>
</body>
</html>
