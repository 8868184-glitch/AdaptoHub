<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution - AdaptoHub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        html, body { overflow: auto !important; height: auto !important; }
        .lesson-container { max-width: 900px; margin: 80px auto 40px; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); }
        .lesson-header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 3px solid #4caf50; }
        .lesson-header h1 { color: #4caf50; font-size: 2.5rem; margin-bottom: 10px; }
        .lesson-header .level-badge { display: inline-block; background: linear-gradient(135deg, #66bb6a 0%, #81c784 100%); color: white; padding: 6px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; }
        .lesson-content { margin-bottom: 40px; }
        .lesson-section { margin-bottom: 35px; }
        .lesson-section h2 { color: #4caf50; font-size: 1.8rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .lesson-section h3 { color: #333; font-size: 1.3rem; margin: 20px 0 10px; }
        .lesson-section p { color: #444; line-height: 1.8; margin-bottom: 15px; font-size: 1.05rem; }
        .concept-box { background: #e8f5e9; border-left: 4px solid #4caf50; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .concept-box h4 { color: #4caf50; margin-bottom: 10px; font-size: 1.2rem; }
        .formula-box { background: #fff3e0; border: 2px solid #ff9800; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center; font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: 600; }
        .example-box { background: #f1f8f4; border-left: 4px solid #2e7d32; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .example-box h4 { color: #2e7d32; margin-bottom: 10px; }
        .quiz-section { background: #f9f9f9; padding: 30px; border-radius: 12px; margin-top: 40px; border: 2px solid #4caf50; }
        .quiz-section h2 { color: #4caf50; text-align: center; margin-bottom: 25px; }
        .question { background: white; padding: 25px; border-radius: 10px; margin-bottom: 25px; border: 2px solid #e0e0e0; }
        .question.correct { border-color: #4caf50; background: #f1f8f4; }
        .question.incorrect { border-color: #f44336; background: #ffebee; }
        .question h3 { color: #333; margin-bottom: 15px; font-size: 1.2rem; }
        .options { display: flex; flex-direction: column; gap: 12px; }
        .option { padding: 15px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: white; }
        .option:hover { border-color: #4caf50; background: #e8f5e9; }
        .option.selected { border-color: #4caf50; background: #e8f5e9; }
        .option.correct { border-color: #4caf50; background: #f1f8f4; }
        .option.incorrect { border-color: #f44336; background: #ffebee; }
        .feedback { margin-top: 15px; padding: 12px; border-radius: 6px; display: none; }
        .feedback.show { display: block; }
        .feedback.correct { background: #f1f8f4; color: #2e7d32; border: 1px solid #4caf50; }
        .feedback.incorrect { background: #ffebee; color: #c62828; border: 1px solid #f44336; }
        .submit-quiz-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; border: none; border-radius: 10px; font-size: 1.2rem; font-weight: 600; cursor: pointer; margin-top: 20px; transition: all 0.3s ease; }
        .submit-quiz-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4); }
        .submit-quiz-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .quiz-result { text-align: center; padding: 30px; background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; border-radius: 12px; margin-top: 20px; display: none; }
        .quiz-result.show { display: block; }
        .quiz-result h3 { font-size: 2rem; margin-bottom: 15px; }
        .quiz-result p { font-size: 1.2rem; margin-bottom: 20px; }
        .next-lesson-btn { padding: 12px 30px; background: white; color: #4caf50; border: none; border-radius: 8px; font-weight: 600; font-size: 1.1rem; cursor: pointer; margin-top: 15px; }
        .next-lesson-btn:hover { background: #f0f0f0; }
    </style>
    <script defer src="background-customizer.js"></script>
</head>
<body>
    <header class="top-banner">
        <div class="logo">
            <img height="45px" src="assets/AdaptoHub.png" alt="Site Logo" />
            <a class="site-title" href="index.html">AdaptoHub</a>
        </div>
        <div class="header-controls">
            <div id="realTimeClock" style="font-weight: 500; color: #fff; margin-right: 15px; font-size: 0.9rem;"></div>
            <button id="darkModeToggle" style="background: none; border: none; cursor: pointer; font-size: 1.3rem; margin-right: 15px; padding: 5px;" title="Toggle dark mode">üåô</button>
        </div>
        <div class="account-display" id="accountDisplayBtn" style="cursor: pointer; position: relative;">
      <span class="account-name" id="accountName">‡∏ä‡∏ç‡∏è ‡∏ä‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê‡∏™‡∏∏‡∏Ç</span>
      <div class="account-avatar" id="accountAvatar"></div>
      
      <div id="accountDetailsDropdown" class="account-details-dropdown" style="display: none;">
        <div style="padding: 16px; border-bottom: 1px solid #e4e7eb; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; color: #1f2933; font-size: 1rem;">Account Information</h3>
          <button onclick="document.getElementById('accountDetailsDropdown').style.display = 'none'; return false;" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #636d79; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;" onmouseover="this.style.color='#1f2933'" onmouseout="this.style.color='#636d79'">√¢≈ì‚Ä¢</button>
        </div>
        <div style="padding: 16px;">
          <div style="margin-bottom: 16px;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Full Name</div>
            <div id="detailsDropdownName" style="color: #1f2933; font-weight: 500; font-size: 0.95rem;">‡∏ä‡∏ç‡∏è ‡∏ä‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê‡∏™‡∏∏‡∏Ç</div>
          </div>
          <div style="margin-bottom: 16px;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Email Address</div>
            <div class="user-email" id="dropdownUserEmail">8868184@student.triamudom.ac.th</div>
          </div>
          <div style="margin-bottom: 16px;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Student ID</div>
            <div id="detailsDropdownStudentId" style="color: #1f2933; font-weight: 500; font-size: 0.95rem;">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: 68184 | ‡∏´‡πâ‡∏≠‡∏á: 665 | ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: 23 | ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô: ‡∏°.4 | ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
          </div>
          <div style="margin-bottom: 16px;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Authentication Provider</div>
            <div id="detailsDropdownProvider" style="color: #1f2933; font-weight: 500; font-size: 0.95rem;">magic-link</div>
          </div>
          <div style="margin-bottom: 0;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Login Date & Time</div>
            $17/2/2569 17:27:10</div>
          </div>
        </div>
      </div>
      
      <div id="profileSettingsDropdown" class="account-details-dropdown" style="display: none;">
        <div style="padding: 16px; border-bottom: 1px solid #e4e7eb; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; color: #1f2933; font-size: 1rem;">Profile Settings</h3>
          <button onclick="document.getElementById('profileSettingsDropdown').style.display = 'none'; return false;" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #636d79; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;" onmouseover="this.style.color='#1f2933'" onmouseout="this.style.color='#636d79'">√¢≈ì‚Ä¢</button>
        </div>
        <div style="padding: 16px;">
          <div style="margin-bottom: 20px;">
            <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Display Name</label>
            <input type="text" id="settingsDisplayName" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95rem; color: #1f2933;" placeholder="Your display name">
          </div>
          <div style="margin-bottom: 20px;">
            <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Email Notifications</label>
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="checkbox" id="settingsEmailNotif" style="margin-right: 8px; cursor: pointer;">
              <span style="font-size: 0.9rem; color: #1f2933;">Receive email notifications</span>
            </label>
          </div>
          <div style="margin-bottom: 20px;">
            <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Theme Preference</label>
            <select id="settingsTheme" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95rem; color: #1f2933; cursor: pointer;">
              <option value="light">Light Mode</option>
              <option value="dark">Dark Mode</option>
              <option value="auto">Auto (System)</option>
            </select>
          </div>
          <div style="margin-bottom: 20px;">
            <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Language</label>
            <select id="settingsLanguage" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95rem; color: #1f2933; cursor: pointer;">
              <option value="en">English</option>
              <option value="es">Espa√É¬±ol</option>
              <option value="fr">Fran√É¬ßais</option>
              <option value="de">Deutsch</option>
            </select>
          </div>
          <div style="margin-bottom: 0;">
            <button onclick="saveProfileSettings()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #0097b2 0%, #00b8d4 100%); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.95rem; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">Save Settings</button>
          </div>
        </div>
      </div>
      
      <div id="learningHistoryDropdown" class="account-details-dropdown" style="display: none;">
        <div style="padding: 16px; border-bottom: 1px solid #e4e7eb; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; color: #1f2933; font-size: 1rem;">Learning History</h3>
          <button onclick="document.getElementById('learningHistoryDropdown').style.display = 'none'; return false;" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #636d79; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;" onmouseover="this.style.color='#1f2933'" onmouseout="this.style.color='#636d79'">√¢≈ì‚Ä¢</button>
        </div>
        <div style="padding: 16px; max-height: 400px; overflow-y: auto;">
          <div style="margin-bottom: 12px; padding: 12px; background: #f5f6f8; border-radius: 8px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div style="font-weight: 600; color: #1f2933; font-size: 0.9rem;" id="learningHistoryStats">No activity recorded</div>
            </div>
            <div id="learningHistoryList" style="font-size: 0.85rem; color: #636d79;">
              <p style="margin: 0; text-align: center; padding: 20px 0; color: #8b92a9;">Start taking quizzes and challenges to build your learning history</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="accountDropdownMenu" class="account-dropdown-menu" style="display: none;">
      <div class="account-dropdown-header">
        <div class="user-avatar-large" id="dropdownUserAvatar"></div>
        <div class="user-info">
          <div class="user-name" id="dropdownUserName">‡∏ä‡∏ç‡∏è ‡∏ä‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê‡∏™‡∏∏‡∏Ç</div>
          <div class="user-email" id="dropdownUserEmail">8868184@student.triamudom.ac.th</div>
          <div class="user-id" id="dropdownStudentId">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: 68184</div>
        </div>
      </div>
      <div class="account-dropdown-divider"></div>
      <div class="account-dropdown-body">
        <a href="javascript:void(0);" class="dropdown-item" onclick="event.preventDefault(); event.stopPropagation(); setTimeout(() => showProfileSettings(), 0); return false;">√¢≈°‚Ñ¢√Ø¬∏¬è Profile Settings</a>
        <a href="javascript:void(0);" class="dropdown-item" onclick="event.preventDefault(); event.stopPropagation(); setTimeout(() => showAccountDetailsPanel(), 0); return false;">√∞≈∏‚Äú‚Äπ Account Details</a>
        <a href="javascript:void(0);" class="dropdown-item" onclick="event.preventDefault(); event.stopPropagation(); setTimeout(() => showLearningHistory(), 0); return false;">√∞≈∏‚Äú≈° Learning History</a>
      </div>
      <div class="account-dropdown-divider"></div>
      <div class="account-dropdown-footer">
        <button class="logout-btn" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>
    </div>
        </header>

    <div class="lesson-container">
        <div class="lesson-header">
            <h1>ü¶é Evolution</h1>
            <span class="level-badge">Level 2 ‚Ä¢ Biology</span>
        </div>

        <div class="lesson-content">
            <div class="lesson-section">
                <h2>üìñ Introduction to Evolution</h2>
                <p>Evolution is the process by which species change over time through variation and natural selection. It explains the diversity of life on Earth and how all organisms are related.</p>
                <div class="concept-box">
                    <h4>What You'll Learn:</h4>
                    <p>‚úì Natural selection and adaptation<br>‚úì Evidence for evolution<br>‚úì Mechanisms of evolution<br>‚úì Speciation and biodiversity</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>üéØ Natural Selection</h2>
                <p>Charles Darwin's theory of natural selection explains how populations evolve over time.</p>
                <div class="concept-box">
                    <h4>Four Principles of Natural Selection:</h4>
                    <p>1. <strong>Variation:</strong> Individuals in a population differ in traits<br>2. <strong>Inheritance:</strong> Traits are passed from parents to offspring<br>3. <strong>Overproduction:</strong> More offspring produced than can survive<br>4. <strong>Differential Survival:</strong> Individuals with advantageous traits survive and reproduce more</p>
                </div>
                <div class="example-box">
                    <h4>Example: Peppered Moths</h4>
                    <p>During the Industrial Revolution, dark-colored moths became more common in polluted areas because they were better camouflaged against dark tree bark, avoiding predation.</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>‚ö° Evidence for Evolution</h2>
                
                <h3>1. Fossil Record</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Preserved remains show how organisms changed over time<br>‚Ä¢ Transitional fossils show intermediate forms<br>‚Ä¢ Example: Archaeopteryx (bird-dinosaur link)</p>
                </div>

                <h3>2. Comparative Anatomy</h3>
                <div class="concept-box">
                    <p>‚Ä¢ <strong>Homologous structures:</strong> Similar structure, different function (human arm, whale flipper)<br>‚Ä¢ <strong>Vestigial structures:</strong> Reduced structures with little/no function (human appendix, whale hip bones)<br>‚Ä¢ Show common ancestry</p>
                </div>

                <h3>3. Molecular Biology</h3>
                <div class="concept-box">
                    <p>‚Ä¢ DNA and protein similarities between species<br>‚Ä¢ More similar DNA = more closely related<br>‚Ä¢ Universal genetic code across all life</p>
                </div>

                <h3>4. Embryology</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Embryos of different species show similar early development<br>‚Ä¢ Suggests common ancestry</p>
                </div>

                <h3>5. Biogeography</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Distribution of species across continents<br>‚Ä¢ Island species resemble nearby mainland species<br>‚Ä¢ Example: Gal√°pagos finches</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>üî¨ Mechanisms of Evolution</h2>
                
                <h3>Natural Selection</h3>
                <p>Individuals with beneficial traits survive and reproduce more successfully.</p>

                <h3>Genetic Drift</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Random changes in allele frequencies<br>‚Ä¢ Greater effect in small populations<br>‚Ä¢ Example: Founder effect, bottleneck effect</p>
                </div>

                <h3>Gene Flow</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Movement of alleles between populations<br>‚Ä¢ Occurs through migration<br>‚Ä¢ Increases genetic diversity</p>
                </div>

                <h3>Mutation</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Source of new genetic variation<br>‚Ä¢ Random changes in DNA<br>‚Ä¢ Can be beneficial, harmful, or neutral</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>üåø Speciation</h2>
                <p>The formation of new species occurs when populations become reproductively isolated.</p>
                <div class="concept-box">
                    <h4>Types of Speciation:</h4>
                    <p>‚Ä¢ <strong>Allopatric:</strong> Geographic separation (mountain range, ocean)<br>‚Ä¢ <strong>Sympatric:</strong> Occurs in same location (polyploidy in plants)<br>‚Ä¢ <strong>Reproductive isolation:</strong> Prevents gene flow between populations</p>
                </div>
                <div class="example-box">
                    <h4>Example: Darwin's Finches</h4>
                    <p>Different beak shapes evolved on different Gal√°pagos islands based on available food sources, leading to multiple new species from a common ancestor.</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>üåç Real-World Applications</h2>
                <ul style="color: #444; line-height: 1.8; font-size: 1.05rem;">
                    <li>Antibiotic resistance in bacteria</li>
                    <li>Vaccine development</li>
                    <li>Conservation biology and endangered species</li>
                    <li>Agricultural crop and livestock improvement</li>
                    <li>Understanding human evolution and migration</li>
                    <li>Pest control strategies</li>
                </ul>
            </div>
        </div>

        <div class="quiz-section">
            <h2>‚úèÔ∏è Test Your Knowledge</h2>
            <p style="text-align: center; color: #666; margin-bottom: 25px;">Answer these questions to demonstrate your mastery of Evolution</p>
            <div id="quizContainer"></div>
            <button class="submit-quiz-btn" id="submitQuiz">Submit Answers</button>
            <div class="quiz-result" id="quizResult"></div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="simple-avatar.js"></script>
    <script src="learning-path.js"></script>
    <script src="analytics.js"></script>
    <script src="gamification.js"></script>
    <script>
        function updateClock(){const now=new Date();const options={weekday:'short',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'};const clockEl=document.getElementById('realTimeClock');if(clockEl)clockEl.textContent=now.toLocaleString('en-US',options);}updateClock();setInterval(updateClock,1000);const darkModeToggle=document.getElementById('darkModeToggle');const isDark=localStorage.getItem('darkMode')==='true';if(isDark){document.documentElement.setAttribute('data-theme','dark');darkModeToggle.textContent='‚òÄÔ∏è';}darkModeToggle.addEventListener('click',()=>{const currentTheme=document.documentElement.getAttribute('data-theme');if(currentTheme==='dark'){document.documentElement.setAttribute('data-theme','light');localStorage.setItem('darkMode','false');darkModeToggle.textContent='üåô';}else{document.documentElement.setAttribute('data-theme','dark');localStorage.setItem('darkMode','true');darkModeToggle.textContent='‚òÄÔ∏è';}});
    </script>
    <script>
        const questions = [
            {id: 1, question: "What is natural selection?", options: ["Random genetic changes", "Survival and reproduction of individuals with advantageous traits", "Movement of organisms between populations", "Creation of new species"], correct: 1, explanation: "Natural selection is the process where individuals with beneficial traits are more likely to survive and reproduce."},
            {id: 2, question: "Which structure is an example of vestigial structures in humans?", options: ["Heart", "Appendix", "Brain", "Lungs"], correct: 1, explanation: "The appendix is a vestigial structure - a reduced organ with little to no current function, evidence of evolution."},
            {id: 3, question: "What type of evidence compares DNA sequences between species?", options: ["Fossil record", "Comparative anatomy", "Molecular biology", "Biogeography"], correct: 2, explanation: "Molecular biology evidence uses DNA and protein comparisons to determine evolutionary relationships."},
            {id: 4, question: "What is the ultimate source of new genetic variation?", options: ["Natural selection", "Genetic drift", "Mutation", "Gene flow"], correct: 2, explanation: "Mutations are random changes in DNA and the ultimate source of all new genetic variation."},
            {id: 5, question: "Which type of speciation occurs due to geographic separation?", options: ["Sympatric", "Allopatric", "Parapatric", "Peripatric"], correct: 1, explanation: "Allopatric speciation occurs when populations are geographically separated (by mountains, water, etc.)."}
        ];

        let userAnswers = {}, quizSubmitted = false;

        function renderQuiz() {
            document.getElementById('quizContainer').innerHTML = questions.map((q, i) => `
                <div class="question" id="question${q.id}">
                    <h3>Question ${i + 1}</h3>
                    <p style="color: #333; margin-bottom: 15px; font-size: 1.05rem;">${q.question}</p>
                    <div class="options">
                        ${q.options.map((opt, idx) => `
                            <div class="option" onclick="selectOption(${q.id}, ${idx})">
                                <input type="radio" name="q${q.id}" id="q${q.id}_${idx}" style="margin-right: 10px;">
                                <label for="q${q.id}_${idx}" style="cursor: pointer;">${opt}</label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedback${q.id}"></div>
                </div>
            `).join('');
        }

        function selectOption(qId, optIdx) {
            if (quizSubmitted) return;
            userAnswers[qId] = optIdx;
            const question = document.getElementById(`question${qId}`);
            question.querySelectorAll('.option').forEach((opt, idx) => {
                opt.classList.toggle('selected', idx === optIdx);
                opt.querySelector('input').checked = idx === optIdx;
            });
        }

        function submitQuiz() {
            if (Object.keys(userAnswers).length < questions.length) { alert('Please answer all questions!'); return; }
            quizSubmitted = true;
            let correctCount = 0;
            questions.forEach(q => {
                const correct = userAnswers[q.id] === q.correct;
                if (correct) correctCount++;
                const questionEl = document.getElementById(`question${q.id}`);
                questionEl.classList.add(correct ? 'correct' : 'incorrect');
                questionEl.querySelectorAll('.option').forEach((opt, idx) => {
                    if (idx === q.correct) opt.classList.add('correct');
                    else if (idx === userAnswers[q.id]) opt.classList.add('incorrect');
                });
                document.getElementById(`feedback${q.id}`).className = `feedback show ${correct ? 'correct' : 'incorrect'}`;
                document.getElementById(`feedback${q.id}`).innerHTML = `${correct ? '‚úì Correct!' : '‚úó Incorrect.'} ${q.explanation}`;
            });
            const pct = Math.round((correctCount / questions.length) * 100);
            document.getElementById('quizResult').className = 'quiz-result show';
            document.getElementById('quizResult').innerHTML = `<h3>${pct >= 80 ? 'üéâ Excellent!' : pct >= 60 ? 'üëç Good Job!' : 'üí™ Keep Practicing!'}</h3><p>You scored ${correctCount}/${questions.length} (${pct}%)</p>${pct >= 60 ? '<button class="next-lesson-btn" onclick="completeLesson(' + pct + ')">Complete & Continue</button>' : '<button class="next-lesson-btn" onclick="location.reload()">Try Again</button>'}`;
            document.getElementById('submitQuiz').disabled = true;
        }

        function completeLesson(score) {
            if (typeof recordLearningActivity === 'function') {
                recordLearningActivity('lesson', 'Evolution', score, 100);
            }
            skillTreeSystem.unlockUnit('science', 'biology', 'b3', score);
            if (window.analyticsSystem) analyticsSystem.recordQuizCompletion({subject: 'Biology', topic: 'Evolution', score, maxScore: 100, questionsAnswered: questions.length});
            if (window.gamificationSystem) gamificationSystem.addPoints(Math.floor(score / 10) * 10 + 50, 'Completed Evolution');
            window.dispatchEvent(new CustomEvent('unitCompleted', {detail: {unitId: 'b3', subject: 'science', module: 'biology', score}}));
            alert(`Congratulations! You've completed Evolution with ${score}% mastery!\n\nPoints earned: ${Math.floor(score / 10) * 10 + 50}`);
            window.location.href = 'analytics-dashboard.html';
        }

        document.getElementById('submitQuiz').addEventListener('click', submitQuiz);
        renderQuiz();
    </script>
</body>
</html>
