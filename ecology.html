<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecology - AdaptoHub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        html, body { overflow: auto !important; height: auto !important; }
        .lesson-container { max-width: 900px; margin: 80px auto 40px; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); }
        .lesson-header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 3px solid #4caf50; }
        .lesson-header h1 { color: #4caf50; font-size: 2.5rem; margin-bottom: 10px; }
        .lesson-header .level-badge { display: inline-block; background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%); color: white; padding: 6px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; }
        .lesson-content { margin-bottom: 40px; }
        .lesson-section { margin-bottom: 35px; }
        .lesson-section h2 { color: #4caf50; font-size: 1.8rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .lesson-section h3 { color: #333; font-size: 1.3rem; margin: 20px 0 10px; }
        .lesson-section p { color: #444; line-height: 1.8; margin-bottom: 15px; font-size: 1.05rem; }
        .concept-box { background: #e8f5e9; border-left: 4px solid #4caf50; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .concept-box h4 { color: #4caf50; margin-bottom: 10px; font-size: 1.2rem; }
        .formula-box { background: #fff3e0; border: 2px solid #ff9800; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center; font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: 600; }
        .example-box { background: #f1f8f4; border-left: 4px solid #2e7d32; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .example-box h4 { color: #2e7d32; margin-bottom: 10px; }
        .quiz-section { background: #f9f9f9; padding: 30px; border-radius: 12px; margin-top: 40px; border: 2px solid #4caf50; }
        .quiz-section h2 { color: #4caf50; text-align: center; margin-bottom: 25px; }
        .question { background: white; padding: 25px; border-radius: 10px; margin-bottom: 25px; border: 2px solid #e0e0e0; }
        .question.correct { border-color: #4caf50; background: #f1f8f4; }
        .question.incorrect { border-color: #f44336; background: #ffebee; }
        .question h3 { color: #333; margin-bottom: 15px; font-size: 1.2rem; }
        .options { display: flex; flex-direction: column; gap: 12px; }
        .option { padding: 15px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: white; }
        .option:hover { border-color: #4caf50; background: #e8f5e9; }
        .option.selected { border-color: #4caf50; background: #e8f5e9; }
        .option.correct { border-color: #4caf50; background: #f1f8f4; }
        .option.incorrect { border-color: #f44336; background: #ffebee; }
        .feedback { margin-top: 15px; padding: 12px; border-radius: 6px; display: none; }
        .feedback.show { display: block; }
        .feedback.correct { background: #f1f8f4; color: #2e7d32; border: 1px solid #4caf50; }
        .feedback.incorrect { background: #ffebee; color: #c62828; border: 1px solid #f44336; }
        .submit-quiz-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; border: none; border-radius: 10px; font-size: 1.2rem; font-weight: 600; cursor: pointer; margin-top: 20px; transition: all 0.3s ease; }
        .submit-quiz-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4); }
        .submit-quiz-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .quiz-result { text-align: center; padding: 30px; background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; border-radius: 12px; margin-top: 20px; display: none; }
        .quiz-result.show { display: block; }
        .quiz-result h3 { font-size: 2rem; margin-bottom: 15px; }
        .quiz-result p { font-size: 1.2rem; margin-bottom: 20px; }
        .next-lesson-btn { padding: 12px 30px; background: white; color: #4caf50; border: none; border-radius: 8px; font-weight: 600; font-size: 1.1rem; cursor: pointer; margin-top: 15px; }
        .next-lesson-btn:hover { background: #f0f0f0; }
    </style>
    <script defer src="background-customizer.js"></script>
</head>
<body>
    <header class="top-banner">
        <div class="logo">
            <img height="45px" src="assets/AdaptoHub.png" alt="Site Logo" />
            <a class="site-title" href="index.html">AdaptoHub</a>
        </div>
        <div class="header-controls">
            <div id="realTimeClock" style="font-weight: 500; color: #fff; margin-right: 15px; font-size: 0.9rem;"></div>
            <button id="darkModeToggle" style="background: none; border: none; cursor: pointer; font-size: 1.3rem; margin-right: 15px; padding: 5px;" title="Toggle dark mode">üåô</button>
        </div>
        <div class="account-display" id="accountDisplayBtn" style="cursor: pointer; position: relative;">
      <span class="account-name" id="accountName">‡∏ä‡∏ç‡∏è ‡∏ä‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê‡∏™‡∏∏‡∏Ç</span>
      <div class="account-avatar" id="accountAvatar"></div>
      
      <div id="accountDetailsDropdown" class="account-details-dropdown" style="display: none;">
        <div style="padding: 16px; border-bottom: 1px solid #e4e7eb; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; color: #1f2933; font-size: 1rem;">Account Information</h3>
          <button onclick="document.getElementById('accountDetailsDropdown').style.display = 'none'; return false;" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #636d79; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;" onmouseover="this.style.color='#1f2933'" onmouseout="this.style.color='#636d79'">√¢≈ì‚Ä¢</button>
        </div>
        <div style="padding: 16px;">
          <div style="margin-bottom: 16px;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Full Name</div>
            <div id="detailsDropdownName" style="color: #1f2933; font-weight: 500; font-size: 0.95rem;">‡∏ä‡∏ç‡∏è ‡∏ä‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê‡∏™‡∏∏‡∏Ç</div>
          </div>
          <div style="margin-bottom: 16px;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Email Address</div>
            <div class="user-email" id="dropdownUserEmail">8868184@student.triamudom.ac.th</div>
          </div>
          <div style="margin-bottom: 16px;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Student ID</div>
            <div id="detailsDropdownStudentId" style="color: #1f2933; font-weight: 500; font-size: 0.95rem;">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: 68184 | ‡∏´‡πâ‡∏≠‡∏á: 665 | ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: 23 | ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô: ‡∏°.4 | ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
          </div>
          <div style="margin-bottom: 16px;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Authentication Provider</div>
            <div id="detailsDropdownProvider" style="color: #1f2933; font-weight: 500; font-size: 0.95rem;">magic-link</div>
          </div>
          <div style="margin-bottom: 0;">
            <div style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">Login Date & Time</div>
            $17/2/2569 17:27:10</div>
          </div>
        </div>
      </div>
      
      <div id="profileSettingsDropdown" class="account-details-dropdown" style="display: none;">
        <div style="padding: 16px; border-bottom: 1px solid #e4e7eb; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; color: #1f2933; font-size: 1rem;">Profile Settings</h3>
          <button onclick="document.getElementById('profileSettingsDropdown').style.display = 'none'; return false;" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #636d79; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;" onmouseover="this.style.color='#1f2933'" onmouseout="this.style.color='#636d79'">√¢≈ì‚Ä¢</button>
        </div>
        <div style="padding: 16px;">
          <div style="margin-bottom: 20px;">
            <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Display Name</label>
            <input type="text" id="settingsDisplayName" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95rem; color: #1f2933;" placeholder="Your display name">
          </div>
          <div style="margin-bottom: 20px;">
            <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Email Notifications</label>
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="checkbox" id="settingsEmailNotif" style="margin-right: 8px; cursor: pointer;">
              <span style="font-size: 0.9rem; color: #1f2933;">Receive email notifications</span>
            </label>
          </div>
          <div style="margin-bottom: 20px;">
            <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Theme Preference</label>
            <select id="settingsTheme" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95rem; color: #1f2933; cursor: pointer;">
              <option value="light">Light Mode</option>
              <option value="dark">Dark Mode</option>
              <option value="auto">Auto (System)</option>
            </select>
          </div>
          <div style="margin-bottom: 20px;">
            <label style="font-size: 0.75rem; color: #8b92a9; text-transform: uppercase; font-weight: 600; margin-bottom: 6px; display: block;">Language</label>
            <select id="settingsLanguage" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95rem; color: #1f2933; cursor: pointer;">
              <option value="en">English</option>
              <option value="es">Espa√É¬±ol</option>
              <option value="fr">Fran√É¬ßais</option>
              <option value="de">Deutsch</option>
            </select>
          </div>
          <div style="margin-bottom: 0;">
            <button onclick="saveProfileSettings()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #0097b2 0%, #00b8d4 100%); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.95rem; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">Save Settings</button>
          </div>
        </div>
      </div>
      
      <div id="learningHistoryDropdown" class="account-details-dropdown" style="display: none;">
        <div style="padding: 16px; border-bottom: 1px solid #e4e7eb; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; color: #1f2933; font-size: 1rem;">Learning History</h3>
          <button onclick="document.getElementById('learningHistoryDropdown').style.display = 'none'; return false;" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #636d79; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;" onmouseover="this.style.color='#1f2933'" onmouseout="this.style.color='#636d79'">√¢≈ì‚Ä¢</button>
        </div>
        <div style="padding: 16px; max-height: 400px; overflow-y: auto;">
          <div style="margin-bottom: 12px; padding: 12px; background: #f5f6f8; border-radius: 8px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div style="font-weight: 600; color: #1f2933; font-size: 0.9rem;" id="learningHistoryStats">No activity recorded</div>
            </div>
            <div id="learningHistoryList" style="font-size: 0.85rem; color: #636d79;">
              <p style="margin: 0; text-align: center; padding: 20px 0; color: #8b92a9;">Start taking quizzes and challenges to build your learning history</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="accountDropdownMenu" class="account-dropdown-menu" style="display: none;">
      <div class="account-dropdown-header">
        <div class="user-avatar-large" id="dropdownUserAvatar"></div>
        <div class="user-info">
          <div class="user-name" id="dropdownUserName">‡∏ä‡∏ç‡∏è ‡∏ä‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê‡∏™‡∏∏‡∏Ç</div>
          <div class="user-email" id="dropdownUserEmail">8868184@student.triamudom.ac.th</div>
          <div class="user-id" id="dropdownStudentId">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: 68184</div>
        </div>
      </div>
      <div class="account-dropdown-divider"></div>
      <div class="account-dropdown-body">
        <a href="javascript:void(0);" class="dropdown-item" onclick="event.preventDefault(); event.stopPropagation(); setTimeout(() => showProfileSettings(), 0); return false;">√¢≈°‚Ñ¢√Ø¬∏¬è Profile Settings</a>
        <a href="javascript:void(0);" class="dropdown-item" onclick="event.preventDefault(); event.stopPropagation(); setTimeout(() => showAccountDetailsPanel(), 0); return false;">√∞≈∏‚Äú‚Äπ Account Details</a>
        <a href="javascript:void(0);" class="dropdown-item" onclick="event.preventDefault(); event.stopPropagation(); setTimeout(() => showLearningHistory(), 0); return false;">√∞≈∏‚Äú≈° Learning History</a>
      </div>
      <div class="account-dropdown-divider"></div>
      <div class="account-dropdown-footer">
        <button class="logout-btn" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>
    </div>
        </header>

    <div class="lesson-container">
        <div class="lesson-header">
            <h1>üåç Ecology</h1>
            <span class="level-badge">Level 3 ‚Ä¢ Biology</span>
        </div>

        <div class="lesson-content">
            <div class="lesson-section">
                <h2>üìñ Introduction to Ecology</h2>
                <p>Ecology is the study of interactions between organisms and their environment. It examines how living things affect each other and how they interact with non-living components of ecosystems.</p>
                <div class="concept-box">
                    <h4>What You'll Learn:</h4>
                    <p>‚úì Ecosystem components and organization<br>‚úì Energy flow and food chains<br>‚úì Nutrient cycles<br>‚úì Population dynamics and interactions</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>üéØ Levels of Organization</h2>
                <div class="concept-box">
                    <p><strong>Individual</strong> ‚Üí <strong>Population</strong> ‚Üí <strong>Community</strong> ‚Üí <strong>Ecosystem</strong> ‚Üí <strong>Biome</strong> ‚Üí <strong>Biosphere</strong></p>
                    <p>‚Ä¢ <strong>Population:</strong> Same species in an area<br>‚Ä¢ <strong>Community:</strong> All populations in an area<br>‚Ä¢ <strong>Ecosystem:</strong> Community + abiotic factors<br>‚Ä¢ <strong>Biome:</strong> Large region with similar climate and organisms</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>‚ö° Energy Flow in Ecosystems</h2>
                
                <h3>Trophic Levels</h3>
                <div class="concept-box">
                    <p>1. <strong>Producers (Autotrophs):</strong> Make their own food via photosynthesis (plants, algae)<br>2. <strong>Primary Consumers (Herbivores):</strong> Eat producers (rabbits, deer)<br>3. <strong>Secondary Consumers (Carnivores):</strong> Eat herbivores (snakes, foxes)<br>4. <strong>Tertiary Consumers:</strong> Eat other carnivores (hawks, lions)<br>5. <strong>Decomposers:</strong> Break down dead matter (bacteria, fungi)</p>
                </div>

                <h3>Food Chains and Food Webs</h3>
                <div class="example-box">
                    <h4>Example Food Chain:</h4>
                    <p>Sun ‚Üí Grass ‚Üí Rabbit ‚Üí Fox ‚Üí Decomposers</p>
                </div>
                <div class="concept-box">
                    <p>‚Ä¢ <strong>Food Chain:</strong> Linear sequence of who eats whom<br>‚Ä¢ <strong>Food Web:</strong> Complex network of interconnected food chains<br>‚Ä¢ More realistic representation of ecosystem feeding relationships</p>
                </div>

                <h3>Energy Pyramid</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Only ~10% of energy transfers between levels<br>‚Ä¢ 90% lost as heat through metabolism<br>‚Ä¢ Explains why there are fewer top predators<br>‚Ä¢ Biomass decreases at higher levels</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>‚ôªÔ∏è Biogeochemical Cycles</h2>
                
                <h3>Carbon Cycle</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Plants absorb CO‚ÇÇ during photosynthesis<br>‚Ä¢ Animals release CO‚ÇÇ during respiration<br>‚Ä¢ Decomposition returns carbon to soil<br>‚Ä¢ Fossil fuel combustion adds CO‚ÇÇ to atmosphere</p>
                </div>

                <h3>Nitrogen Cycle</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Nitrogen fixation by bacteria<br>‚Ä¢ Plants absorb nitrates from soil<br>‚Ä¢ Animals get nitrogen from eating plants/animals<br>‚Ä¢ Decomposers return nitrogen to soil<br>‚Ä¢ Denitrification returns N‚ÇÇ to atmosphere</p>
                </div>

                <h3>Water Cycle</h3>
                <div class="concept-box">
                    <p>‚Ä¢ Evaporation from water bodies<br>‚Ä¢ Transpiration from plants<br>‚Ä¢ Condensation forms clouds<br>‚Ä¢ Precipitation (rain, snow)<br>‚Ä¢ Runoff returns water to oceans</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>ü§ù Population Interactions</h2>
                
                <h3>Competition</h3>
                <p>Organisms compete for limited resources (food, water, space, light).</p>

                <h3>Predation</h3>
                <p>One organism (predator) hunts and eats another (prey).</p>

                <h3>Symbiosis</h3>
                <div class="concept-box">
                    <p>‚Ä¢ <strong>Mutualism:</strong> Both benefit (bees and flowers)<br>‚Ä¢ <strong>Commensalism:</strong> One benefits, other unaffected (barnacles on whales)<br>‚Ä¢ <strong>Parasitism:</strong> One benefits, other harmed (ticks on mammals)</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>üìä Population Dynamics</h2>
                <div class="concept-box">
                    <h4>Factors Affecting Population Size:</h4>
                    <p><strong>Density-Dependent:</strong><br>‚Ä¢ Food availability<br>‚Ä¢ Disease spread<br>‚Ä¢ Competition<br>‚Ä¢ Predation</p>
                    <p><strong>Density-Independent:</strong><br>‚Ä¢ Natural disasters<br>‚Ä¢ Climate/weather<br>‚Ä¢ Human activities</p>
                </div>
            </div>

            <div class="lesson-section">
                <h2>üåç Real-World Applications</h2>
                <ul style="color: #444; line-height: 1.8; font-size: 1.05rem;">
                    <li>Conservation and endangered species protection</li>
                    <li>Climate change mitigation</li>
                    <li>Sustainable agriculture and fishing</li>
                    <li>Habitat restoration</li>
                    <li>Invasive species management</li>
                    <li>Biodiversity preservation</li>
                </ul>
            </div>
        </div>

        <div class="quiz-section">
            <h2>‚úèÔ∏è Test Your Knowledge</h2>
            <p style="text-align: center; color: #666; margin-bottom: 25px;">Answer these questions to demonstrate your mastery of Ecology</p>
            <div id="quizContainer"></div>
            <button class="submit-quiz-btn" id="submitQuiz">Submit Answers</button>
            <div class="quiz-result" id="quizResult"></div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="simple-avatar.js"></script>
    <script src="learning-path.js"></script>
    <script src="analytics.js"></script>
    <script src="gamification.js"></script>
    <script>
        function updateClock(){const now=new Date();const options={weekday:'short',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'};const clockEl=document.getElementById('realTimeClock');if(clockEl)clockEl.textContent=now.toLocaleString('en-US',options);}updateClock();setInterval(updateClock,1000);const darkModeToggle=document.getElementById('darkModeToggle');const isDark=localStorage.getItem('darkMode')==='true';if(isDark){document.documentElement.setAttribute('data-theme','dark');darkModeToggle.textContent='‚òÄÔ∏è';}darkModeToggle.addEventListener('click',()=>{const currentTheme=document.documentElement.getAttribute('data-theme');if(currentTheme==='dark'){document.documentElement.setAttribute('data-theme','light');localStorage.setItem('darkMode','false');darkModeToggle.textContent='üåô';}else{document.documentElement.setAttribute('data-theme','dark');localStorage.setItem('darkMode','true');darkModeToggle.textContent='‚òÄÔ∏è';}});
    </script>
    <script>
        const questions = [
            {id: 1, question: "Which organisms are at the base of most food chains?", options: ["Herbivores", "Carnivores", "Producers", "Decomposers"], correct: 2, explanation: "Producers (plants and algae) form the base of food chains by converting sunlight into energy through photosynthesis."},
            {id: 2, question: "Approximately what percentage of energy transfers from one trophic level to the next?", options: ["10%", "50%", "90%", "100%"], correct: 0, explanation: "Only about 10% of energy is transferred between trophic levels; the rest is lost as heat through metabolism."},
            {id: 3, question: "What type of symbiosis benefits both organisms?", options: ["Parasitism", "Commensalism", "Mutualism", "Predation"], correct: 2, explanation: "Mutualism is a symbiotic relationship where both organisms benefit, such as bees pollinating flowers while getting nectar."},
            {id: 4, question: "Which cycle involves nitrogen fixation by bacteria?", options: ["Water cycle", "Carbon cycle", "Nitrogen cycle", "Phosphorus cycle"], correct: 2, explanation: "The nitrogen cycle includes nitrogen fixation, where bacteria convert atmospheric nitrogen into forms plants can use."},
            {id: 5, question: "What are organisms that eat only plants called?", options: ["Carnivores", "Herbivores", "Omnivores", "Decomposers"], correct: 1, explanation: "Herbivores are primary consumers that eat only plants and producers."}
        ];

        let userAnswers = {}, quizSubmitted = false;

        function renderQuiz() {
            document.getElementById('quizContainer').innerHTML = questions.map((q, i) => `
                <div class="question" id="question${q.id}">
                    <h3>Question ${i + 1}</h3>
                    <p style="color: #333; margin-bottom: 15px; font-size: 1.05rem;">${q.question}</p>
                    <div class="options">
                        ${q.options.map((opt, idx) => `
                            <div class="option" onclick="selectOption(${q.id}, ${idx})">
                                <input type="radio" name="q${q.id}" id="q${q.id}_${idx}" style="margin-right: 10px;">
                                <label for="q${q.id}_${idx}" style="cursor: pointer;">${opt}</label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedback${q.id}"></div>
                </div>
            `).join('');
        }

        function selectOption(qId, optIdx) {
            if (quizSubmitted) return;
            userAnswers[qId] = optIdx;
            const question = document.getElementById(`question${qId}`);
            question.querySelectorAll('.option').forEach((opt, idx) => {
                opt.classList.toggle('selected', idx === optIdx);
                opt.querySelector('input').checked = idx === optIdx;
            });
        }

        function submitQuiz() {
            if (Object.keys(userAnswers).length < questions.length) { alert('Please answer all questions!'); return; }
            quizSubmitted = true;
            let correctCount = 0;
            questions.forEach(q => {
                const correct = userAnswers[q.id] === q.correct;
                if (correct) correctCount++;
                const questionEl = document.getElementById(`question${q.id}`);
                questionEl.classList.add(correct ? 'correct' : 'incorrect');
                questionEl.querySelectorAll('.option').forEach((opt, idx) => {
                    if (idx === q.correct) opt.classList.add('correct');
                    else if (idx === userAnswers[q.id]) opt.classList.add('incorrect');
                });
                document.getElementById(`feedback${q.id}`).className = `feedback show ${correct ? 'correct' : 'incorrect'}`;
                document.getElementById(`feedback${q.id}`).innerHTML = `${correct ? '‚úì Correct!' : '‚úó Incorrect.'} ${q.explanation}`;
            });
            const pct = Math.round((correctCount / questions.length) * 100);
            document.getElementById('quizResult').className = 'quiz-result show';
            document.getElementById('quizResult').innerHTML = `<h3>${pct >= 80 ? 'üéâ Excellent!' : pct >= 60 ? 'üëç Good Job!' : 'üí™ Keep Practicing!'}</h3><p>You scored ${correctCount}/${questions.length} (${pct}%)</p>${pct >= 60 ? '<button class="next-lesson-btn" onclick="completeLesson(' + pct + ')">Complete & Continue</button>' : '<button class="next-lesson-btn" onclick="location.reload()">Try Again</button>'}`;
            document.getElementById('submitQuiz').disabled = true;
        }

        function completeLesson(score) {
            if (typeof recordLearningActivity === 'function') {
                recordLearningActivity('lesson', 'Ecology', score, 100);
            }
            skillTreeSystem.unlockUnit('science', 'biology', 'b4', score);
            if (window.analyticsSystem) analyticsSystem.recordQuizCompletion({subject: 'Biology', topic: 'Ecology', score, maxScore: 100, questionsAnswered: questions.length});
            if (window.gamificationSystem) gamificationSystem.addPoints(Math.floor(score / 10) * 10 + 50, 'Completed Ecology');
            window.dispatchEvent(new CustomEvent('unitCompleted', {detail: {unitId: 'b4', subject: 'science', module: 'biology', score}}));
            alert(`Congratulations! You've completed Ecology with ${score}% mastery!\n\nPoints earned: ${Math.floor(score / 10) * 10 + 50}`);
            window.location.href = 'analytics-dashboard.html';
        }

        document.getElementById('submitQuiz').addEventListener('click', submitQuiz);
        renderQuiz();
    </script>
</body>
</html>
